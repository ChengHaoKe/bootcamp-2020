<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Ali Ehlen" />
  <meta name="dcterms.date" content="2020-09-02" />
  <title>Day 6: Advanced data manipulation 3 - data.table</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="day6_datatable_slides_files/reveal.js-3.3.0.1/css/reveal.css"/>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="day6_datatable_slides_files/reveal.js-3.3.0.1/css/theme/simple.css" id="theme">


  <!-- some tweaks to reveal css -->
  <style type="text/css">
    .reveal h1 { font-size: 2.0em; }
    .reveal h2 { font-size: 1.5em;  }
    .reveal h3 { font-size: 1.25em;	}
    .reveal h4 { font-size: 1em;	}

    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0px 0px;
    }



    .reveal table {
      border-width: 1px;
      border-spacing: 2px;
      border-style: dotted;
      border-color: gray;
      border-collapse: collapse;
      font-size: 0.7em;
    }

    .reveal table th {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      font-weight: bold;
      border-style: dotted;
      border-color: gray;
    }

    .reveal table td {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      border-style: dotted;
      border-color: gray;
    }


  </style>

    <style type="text/css">code{white-space: pre;}</style>


<!-- Printing and PDF exports -->
<script id="paper-css" type="application/dynamic-css">

/* Default Print Stylesheet Template
   by Rob Glazebrook of CSSnewbie.com
   Last Updated: June 4, 2008

   Feel free (nay, compelled) to edit, append, and
   manipulate this file as you see fit. */


@media print {

	/* SECTION 1: Set default width, margin, float, and
	   background. This prevents elements from extending
	   beyond the edge of the printed page, and prevents
	   unnecessary background images from printing */
	html {
		background: #fff;
		width: auto;
		height: auto;
		overflow: visible;
	}
	body {
		background: #fff;
		font-size: 20pt;
		width: auto;
		height: auto;
		border: 0;
		margin: 0 5%;
		padding: 0;
		overflow: visible;
		float: none !important;
	}

	/* SECTION 2: Remove any elements not needed in print.
	   This would include navigation, ads, sidebars, etc. */
	.nestedarrow,
	.controls,
	.fork-reveal,
	.share-reveal,
	.state-background,
	.reveal .progress,
	.reveal .backgrounds {
		display: none !important;
	}

	/* SECTION 3: Set body font face, size, and color.
	   Consider using a serif font for readability. */
	body, p, td, li, div {
		font-size: 20pt!important;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		color: #000;
	}

	/* SECTION 4: Set heading font face, sizes, and color.
	   Differentiate your headings from your body text.
	   Perhaps use a large sans-serif for distinction. */
	h1,h2,h3,h4,h5,h6 {
		color: #000!important;
		height: auto;
		line-height: normal;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		text-shadow: 0 0 0 #000 !important;
		text-align: left;
		letter-spacing: normal;
	}
	/* Need to reduce the size of the fonts for printing */
	h1 { font-size: 28pt !important;  }
	h2 { font-size: 24pt !important; }
	h3 { font-size: 22pt !important; }
	h4 { font-size: 22pt !important; font-variant: small-caps; }
	h5 { font-size: 21pt !important; }
	h6 { font-size: 20pt !important; font-style: italic; }

	/* SECTION 5: Make hyperlinks more usable.
	   Ensure links are underlined, and consider appending
	   the URL to the end of the link for usability. */
	a:link,
	a:visited {
		color: #000 !important;
		font-weight: bold;
		text-decoration: underline;
	}
	/*
	.reveal a:link:after,
	.reveal a:visited:after {
		content: " (" attr(href) ") ";
		color: #222 !important;
		font-size: 90%;
	}
	*/


	/* SECTION 6: more reveal.js specific additions by @skypanther */
	ul, ol, div, p {
		visibility: visible;
		position: static;
		width: auto;
		height: auto;
		display: block;
		overflow: visible;
		margin: 0;
		text-align: left !important;
	}
	.reveal pre,
	.reveal table {
		margin-left: 0;
		margin-right: 0;
	}
	.reveal pre code {
		padding: 20px;
		border: 1px solid #ddd;
	}
	.reveal blockquote {
		margin: 20px 0;
	}
	.reveal .slides {
		position: static !important;
		width: auto !important;
		height: auto !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 0 !important;
		zoom: 1 !important;

		overflow: visible !important;
		display: block !important;

		text-align: left !important;
		-webkit-perspective: none;
		   -moz-perspective: none;
		    -ms-perspective: none;
		        perspective: none;

		-webkit-perspective-origin: 50% 50%;
		   -moz-perspective-origin: 50% 50%;
		    -ms-perspective-origin: 50% 50%;
		        perspective-origin: 50% 50%;
	}
	.reveal .slides section {
		visibility: visible !important;
		position: static !important;
		width: auto !important;
		height: auto !important;
		display: block !important;
		overflow: visible !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 60px 20px !important;
		z-index: auto !important;

		opacity: 1 !important;

		page-break-after: always !important;

		-webkit-transform-style: flat !important;
		   -moz-transform-style: flat !important;
		    -ms-transform-style: flat !important;
		        transform-style: flat !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;

		-webkit-transition: none !important;
		   -moz-transition: none !important;
		    -ms-transition: none !important;
		        transition: none !important;
	}
	.reveal .slides section.stack {
		padding: 0 !important;
	}
	.reveal section:last-of-type {
		page-break-after: avoid !important;
	}
	.reveal section .fragment {
		opacity: 1 !important;
		visibility: visible !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;
	}
	.reveal section img {
		display: block;
		margin: 15px 0px;
		background: rgba(255,255,255,1);
		border: 1px solid #666;
		box-shadow: none;
	}

	.reveal section small {
		font-size: 0.8em;
	}

}  
</script>


<script id="pdf-css" type="application/dynamic-css">
    
/**
 * This stylesheet is used to print reveal.js
 * presentations to PDF.
 *
 * https://github.com/hakimel/reveal.js#pdf-export
 */

* {
	-webkit-print-color-adjust: exact;
}

body {
	margin: 0 auto !important;
	border: 0;
	padding: 0;
	float: none !important;
	overflow: visible;
}

html {
	width: 100%;
	height: 100%;
	overflow: visible;
}

/* Remove any elements not needed in print. */
.nestedarrow,
.reveal .controls,
.reveal .progress,
.reveal .playback,
.reveal.overview,
.fork-reveal,
.share-reveal,
.state-background {
	display: none !important;
}

h1, h2, h3, h4, h5, h6 {
	text-shadow: 0 0 0 #000 !important;
}

.reveal pre code {
	overflow: hidden !important;
	font-family: Courier, 'Courier New', monospace !important;
}

ul, ol, div, p {
	visibility: visible;
	position: static;
	width: auto;
	height: auto;
	display: block;
	overflow: visible;
	margin: auto;
}
.reveal {
	width: auto !important;
	height: auto !important;
	overflow: hidden !important;
}
.reveal .slides {
	position: static;
	width: 100%;
	height: auto;

	left: auto;
	top: auto;
	margin: 0 !important;
	padding: 0 !important;

	overflow: visible;
	display: block;

	-webkit-perspective: none;
	   -moz-perspective: none;
	    -ms-perspective: none;
	        perspective: none;

	-webkit-perspective-origin: 50% 50%; /* there isn't a none/auto value but 50-50 is the default */
	   -moz-perspective-origin: 50% 50%;
	    -ms-perspective-origin: 50% 50%;
	        perspective-origin: 50% 50%;
}

.reveal .slides section {
	page-break-after: always !important;

	visibility: visible !important;
	position: relative !important;
	display: block !important;
	position: relative !important;

	margin: 0 !important;
	padding: 0 !important;
	box-sizing: border-box !important;
	min-height: 1px;

	opacity: 1 !important;

	-webkit-transform-style: flat !important;
	   -moz-transform-style: flat !important;
	    -ms-transform-style: flat !important;
	        transform-style: flat !important;

	-webkit-transform: none !important;
	   -moz-transform: none !important;
	    -ms-transform: none !important;
	        transform: none !important;
}

.reveal section.stack {
	margin: 0 !important;
	padding: 0 !important;
	page-break-after: avoid !important;
	height: auto !important;
	min-height: auto !important;
}

.reveal img {
	box-shadow: none;
}

.reveal .roll {
	overflow: visible;
	line-height: 1em;
}

/* Slide backgrounds are placed inside of their slide when exporting to PDF */
.reveal section .slide-background {
	display: block !important;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	z-index: -1;
}

/* All elements should be above the slide-background */
.reveal section>* {
	position: relative;
	z-index: 1;
}

/* Display slide speaker notes when 'showNotes' is enabled */
.reveal .speaker-notes-pdf {
	display: block;
	width: 100%;
	max-height: none;
	left: auto;
	top: auto;
	z-index: 100;
}

/* Display slide numbers when 'slideNumber' is enabled */
.reveal .slide-number-pdf {
	display: block;
	position: absolute;
	font-size: 14px;
}

</script>


<script>
var style = document.createElement( 'style' );
style.type = 'text/css';
var style_script_id = window.location.search.match( /print-pdf/gi ) ? 'pdf-css' : 'paper-css';
var style_script = document.getElementById(style_script_id).text;
style.innerHTML = style_script;
document.getElementsByTagName('head')[0].appendChild(style);
</script>

</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">Day 6: Advanced data manipulation 3 - data.table</h1>
    <h2 class="author">Ali Ehlen</h2>
    <h3 class="date">2020-09-02</h3>
</section>

<section><section id="introduction" class="title-slide slide level1"><h1>Introduction</h1></section><section id="what-is-data.table" class="slide level2">
<h2>What is <code>data.table</code>?</h2>
<ul>
<li class="fragment">“<code>data.table</code> is an R package that provides an enhanced version of data.frames”</li>
<li class="fragment">“Briefly, if you are interested in reducing programming and compute time tremendously, then this package is for you.”</li>
</ul>
<ul>
<li class="fragment"><a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">authors of <code>data.table</code></a></li>
</ul>
</section><section id="why-do-we-care" class="slide level2">
<h2>Why do we care?</h2>
<ul>
<li class="fragment"><code>data.table</code> is popular <img data-src="figures/cran_downloads_2020.png" /> data pulled using <code>cranlogs</code> package</li>
</ul>
</section><section id="section" class="slide level2">
<h2></h2>
<ul>
<li><code>data.table</code> is fast (especially on larger data) (<span style="color: blue;">data.table</span>, <span style="color: red;">dplyr</span>) <img data-src="figures/benchmarks.PNG" /> <a href="https://h2oai.github.io/db-benchmark/" class="uri">https://h2oai.github.io/db-benchmark/</a></li>
</ul>
</section><section id="section-1" class="slide level2">
<h2></h2>
<ul>
<li><code>data.table</code> is memory efficient (<span style="color: blue;">data.table</span>, <span style="color: red;">dplyr</span>) <img data-src="figures/benchmarks2.PNG" /> <a href="https://h2oai.github.io/db-benchmark/" class="uri">https://h2oai.github.io/db-benchmark/</a></li>
</ul>
</section><section id="additional-reasons-to-care" class="slide level2">
<h2>Additional reasons to care</h2>
<ul>
<li class="fragment"><code>data.table</code> comes with other features (file i/o, reshape functions)</li>
<li class="fragment">no need for multiple package dependencies</li>
<li class="fragment">syntax is clean, compact, and consistent</li>
<li class="fragment"><code>data.tables</code> are compatible with any function that takes <code>data.frame</code>s</li>
</ul>
</section></section>
<section><section id="data.table-basics" class="title-slide slide level1"><h1><code>data.table</code> basics</h1></section><section id="load-data" class="slide level2">
<h2>Load data</h2>
<p>Load the same data as a <code>data.frame</code> and as a <code>data.table</code> to compare.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># import data.table library</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4">data_file &lt;-<span class="st"> </span>here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;ca_energy_generation.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co"># read in two versions of data, one as a data.frame and one as a data.table</span></a>
<a class="sourceLine" id="cb1-7" title="7">generation_df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(data_file, <span class="dt">stringsAsFactors =</span> F)</a>
<a class="sourceLine" id="cb1-8" title="8"></a>
<a class="sourceLine" id="cb1-9" title="9">generation_dt &lt;-<span class="st"> </span><span class="kw">fread</span>(data_file)</a></code></pre></div>
</section><section id="data.table-inherits-from-a-data.frame." class="slide level2">
<h2><code>data.table</code> inherits from a <code>data.frame</code>.</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">class</span>(generation_df) </a></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">class</span>(generation_dt) </a></code></pre></div>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">View</span>(generation_df)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">View</span>(generation_dt)</a>
<a class="sourceLine" id="cb6-3" title="3">generation_df</a>
<a class="sourceLine" id="cb6-4" title="4">generation_dt</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="kw">str</span>(generation_df)</a>
<a class="sourceLine" id="cb6-6" title="6"><span class="kw">str</span>(generation_dt)</a></code></pre></div>
</section></section>
<section><section id="how-to-use-data.tables" class="title-slide slide level1"><h1>How to use <code>data.table</code>s</h1></section><section id="data.table-syntax" class="slide level2">
<h2><code>data.table</code> syntax</h2>
<ul>
<li class="fragment"><code>dplyr</code> syntax: depends on a small set of verbs</li>
<li class="fragment"><code>data.table</code> syntax: small set of consistent rules input into <code>dt[]</code></li>
<li class="fragment">column names are variables inside <code>dt[]</code> <img data-src="figures/dt_structure.PNG" /> <a href="https://github.com/Rdatatable/data.table/wiki" class="uri">https://github.com/Rdatatable/data.table/wiki</a></li>
</ul>
</section></section>
<section><section id="i-on-which-rows-row-filtering" class="title-slide slide level1"><h1><code>i</code>: “on which rows” (row filtering)</h1></section><section id="i-on-which-rows-row-filtering-1" class="slide level2">
<h2><code>i</code>: “on which rows” (row filtering)</h2>
<ul>
<li>logical operations filter rows</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">generation_dt[wind <span class="op">&gt;</span><span class="st"> </span><span class="dv">4400</span>]</a></code></pre></div>
<pre><code>##                datetime   biogas  biomass      coal geothermal large_hydro
##  1: 2019-09-07 17:00:00 237.5000 395.1667  5.083333   956.1667    2626.250
##  2: 2019-09-07 21:00:00 236.8333 390.3333  6.000000   964.5000    3395.917
##  3: 2019-09-07 22:00:00 236.9167 390.8333  6.000000   968.1667    3101.333
##  4: 2019-09-08 18:00:00 235.0833 369.0833 14.166667   960.5000    3981.000
##  5: 2019-09-08 19:00:00 233.5833 368.6667 14.000000   963.6667    4308.500
##  6: 2019-09-09 17:00:00 233.9167 389.4167 13.750000   974.6667    3075.417
##  7: 2019-09-09 18:00:00 230.1667 390.0833 12.833333   975.9167    4215.917
##  8: 2019-09-09 19:00:00 228.0000 388.4167 12.000000   978.5000    4413.583
##  9: 2019-09-09 20:00:00 227.8333 386.4167 12.583333   979.7500    4414.667
## 10: 2019-09-09 21:00:00 231.1667 383.1667 12.333333   980.5833    3771.417
## 11: 2019-09-09 22:00:00 231.1667 368.9167 13.083333   980.5833    3305.167
## 12: 2019-09-09 23:00:00 231.5000 358.9167 13.750000   980.3333    2704.583
##     natural_gas  nuclear other small_hydro      solar     wind
##  1:   10375.833 2257.250     0    394.5833 6680.25000 4434.000
##  2:    9712.000 2250.167     0    409.1667    0.00000 4409.583
##  3:    8878.417 2249.083     0    406.9167    0.00000 4408.667
##  4:    7189.500 2261.750     0    445.2500 1975.66667 4427.250
##  5:    7809.333 2263.417     0    470.1667   31.58333 4578.083
##  6:    8239.750 2267.083     0    446.4167 6408.91667 4426.667
##  7:    9688.667 2268.167     0    458.1667 1722.00000 4616.583
##  8:    9761.583 2269.000     0    480.6667   19.75000 4894.417
##  9:    9210.583 2267.583     0    467.1667    0.00000 4824.750
## 10:    8475.083 2265.417     0    471.7500    0.00000 4677.917
## 11:    8056.750 2265.417     0    435.6667    0.00000 4681.917
## 12:    6895.417 2266.000     0    413.1667    0.00000 4571.417</code></pre>
</section><section id="i-on-which-rows-row-filtering-2" class="slide level2">
<h2><code>i</code>: “on which rows” (row filtering)</h2>
<ul>
<li>logical operations filter rows</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">generation_dt[wind <span class="op">&gt;</span><span class="st"> </span><span class="dv">4400</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">mday</span>(datetime) <span class="op">==</span><span class="st"> </span><span class="dv">7</span>]</a></code></pre></div>
<pre><code>##               datetime   biogas  biomass     coal geothermal large_hydro
## 1: 2019-09-07 17:00:00 237.5000 395.1667 5.083333   956.1667    2626.250
## 2: 2019-09-07 21:00:00 236.8333 390.3333 6.000000   964.5000    3395.917
## 3: 2019-09-07 22:00:00 236.9167 390.8333 6.000000   968.1667    3101.333
##    natural_gas  nuclear other small_hydro   solar     wind
## 1:   10375.833 2257.250     0    394.5833 6680.25 4434.000
## 2:    9712.000 2250.167     0    409.1667    0.00 4409.583
## 3:    8878.417 2249.083     0    406.9167    0.00 4408.667</code></pre>
<ul>
<li>note: mday is a <code>data.table</code> function that returns the integer day of the month</li>
</ul>
</section><section id="i-on-which-rows-row-filtering-3" class="slide level2">
<h2><code>i</code>: “on which rows” (row filtering)</h2>
<ul>
<li><strong>try it!</strong> select rows for which natural gas generation is less than or equal to 5,000 MW and large hydro generation is greater than 2,000 MW</li>
<li><strong>try it!</strong> select rows for which solar generation is greater than coal generation</li>
<li><strong>bonus:</strong> select rows for which coal generation is greater than 10 MW and solar generation is greater than the median value of solar generation</li>
</ul>
</section><section id="i-on-which-rows-row-filtering-4" class="slide level2">
<h2><code>i</code>: “on which rows” (row filtering)</h2>
<ul>
<li><strong>try it!</strong> select rows for which natural gas generation is less than or equal to 5,000 MW and large hydro generation is greater than 2,000 MW</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">generation_dt[natural_gas <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5000</span> <span class="op">&amp;</span><span class="st"> </span>large_hydro <span class="op">&gt;</span><span class="st"> </span><span class="dv">2000</span>]</a></code></pre></div>
<ul>
<li><strong>try it!</strong> select rows for which solar generation is greater than coal generation</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">generation_dt[solar <span class="op">&gt;</span><span class="st"> </span>coal]</a></code></pre></div>
<ul>
<li><strong>bonus:</strong> select rows for which coal generation is greater than 10 MW and solar generation is greater than the median value of solar generation</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">generation_dt[coal <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span> <span class="op">&amp;</span><span class="st"> </span>solar <span class="op">&gt;</span><span class="st"> </span><span class="kw">median</span>(solar)]</a></code></pre></div>
</section></section>
<section><section id="j-what-to-do-column-operations" class="title-slide slide level1"><h1><code>j</code>: “what to do” (column operations)</h1></section><section id="j-what-to-do-column-operations-1" class="slide level2">
<h2><code>j</code>: “what to do” (column operations)</h2>
<ul>
<li>perform any operation in <code>j</code></li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">generation_dt[,wind]</a></code></pre></div>
<pre><code>##   [1] 2670.1667 2778.8333 2795.2500 2582.5833 2397.4167 2327.0000 2048.8333
##   [8] 1739.1667 1364.0833 1116.5000  816.5000  701.3333  611.0000  612.0000
##  [15]  761.0833 1299.5833 1932.9167 2572.5000 3230.0000 3559.1667 3323.0000
##  [22] 3097.4167 3059.3333 2893.5000 2523.5833 2415.9167 2206.0833 1649.6667
##  [29]  991.5000  714.9167  492.1667  406.9167  362.2500  262.1667  284.0833
##  [36]  283.7500  359.3333  476.5000  841.2500 1080.5833 1284.5833 1213.9167
##  [43] 1419.1667 1667.5000 1832.7500 2062.9167 1996.0833 1735.4167 1622.5000
##  [50] 1723.5000 1849.0833 1552.1667 1425.1667 1363.3333 1294.2500 1162.0000
##  [57] 1337.5000 1400.5833 1249.1667 1110.7500 1044.9167  986.2500 1004.7500
##  [64] 1084.8333 1284.9167 1555.9167 1735.7500 2087.3333 2189.3333 2078.9167
##  [71] 2027.2500 1928.6667 2227.0833 2092.5833 1837.6667 1886.5833 1822.4167
##  [78] 1663.6667 1462.1667 1294.7500 1139.1667 1012.7500  915.4167  808.3333
##  [85] 1035.9167 1420.2500 1944.5000 2315.0000 2692.5000 2725.0833 3108.8333
##  [92] 3645.1667 4054.5833 4049.4167 4154.1667 4107.7500 4078.8333 3859.2500
##  [99] 3878.7500 3809.9167 3812.6667 3672.5000 3643.7500 3464.0000 3433.0000
## [106] 3330.5833 3405.5000 3678.0000 3957.8333 4196.6667 4251.0000 3913.8333
## [113] 4120.5833 4434.0000 4127.9167 3564.1667 4045.8333 4409.5833 4408.6667
## [120] 4294.0833 3628.0833 3118.0833 2928.0833 2726.5833 2677.9167 2772.1667
## [127] 2795.8333 3214.8333 3745.9167 3831.4167 3808.0000 3681.0000 3782.0000
## [134] 3970.7500 4014.1667 3889.0000 4052.6667 4332.0000 4427.2500 4578.0833
## [141] 4364.6667 4007.0833 4198.9167 4175.6667 4023.4167 4062.1667 4153.3333
## [148] 3959.5833 3683.6667 3523.8333 3214.2500 2910.7500 2882.0833 2948.0000
## [155] 2666.4167 2308.8333 1942.7500 2760.0000 3554.7500 3882.6667 4076.9167
## [162] 4426.6667 4616.5833 4894.4167 4824.7500 4677.9167 4681.9167 4571.4167</code></pre>
<ul>
<li>note: what is the data type returned?</li>
</ul>
</section><section id="j-what-to-do-column-operations-2" class="slide level2">
<h2><code>j</code>: “what to do” (column operations)</h2>
<ul>
<li>perform any operation in <code>j</code></li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">generation_dt[,wind <span class="op">+</span><span class="st"> </span>solar]</a></code></pre></div>
<pre><code>##   [1]  2670.1667  2778.8333  2795.2500  2582.5833  2397.4167  2327.0000
##   [7]  2126.0000  4249.8333  8343.7500 10104.5833 10781.7500 11175.4167
##  [13] 10895.1667 10635.0000 10480.1667 10241.2500  9942.6667  8699.4167
##  [19]  5307.5000  3776.0000  3408.4167  3097.4167  3059.3333  2893.5000
##  [25]  2523.5833  2415.9167  2206.0833  1649.6667   991.5000   714.9167
##  [31]   578.5833  2986.0833  7418.0000  9533.1667 10372.3333 10615.9167
##  [37] 10469.1667 10261.6667 10352.5833  9811.7500  8002.6667  5165.4167
##  [43]  2507.4167  1695.5000  1832.7500  2062.9167  1996.0833  1735.4167
##  [49]  1622.5000  1723.5000  1849.0833  1552.1667  1425.1667  1363.3333
##  [55]  1326.6667  2620.3333  5961.3333  8104.1667  8849.3333  9843.5833
##  [61]  9907.4167  9185.5833  9527.7500  9888.7500  9072.5833  6852.8333
##  [67]  3443.2500  2118.6667  2189.3333  2078.9167  2027.2500  1928.6667
##  [73]  2227.0833  2092.5833  1837.6667  1886.5833  1822.4167  1663.6667
##  [79]  1527.5833  3717.2500  8016.8333 10204.8333 10926.2500 11134.8333
##  [85] 11271.8333 11483.9167 11843.9167 12003.3333 11428.9167  8994.5000
##  [91]  5060.3333  3684.5000  4054.5833  4049.4167  4154.1667  4107.7500
##  [97]  4078.8333  3859.2500  3878.7500  3809.9167  3812.6667  3672.5000
## [103]  3711.5833  6138.2500 10841.7500 12954.9167 13769.2500 14285.5833
## [109] 14550.0833 14712.9167 14774.4167 14117.0000 13483.0833 11114.2500
## [115]  6067.6667  3600.3333  4045.8333  4409.5833  4408.6667  4294.0833
## [121]  3628.0833  3118.0833  2928.0833  2726.5833  2677.9167  2772.1667
## [127]  2887.3333  6014.0833 10932.0000 13178.7500 14233.3333 14432.0000
## [133] 14629.0000 14842.8333 14834.3333 14302.6667 13498.8333 11223.0833
## [139]  6402.9167  4609.6667  4364.6667  4007.0833  4198.9167  4175.6667
## [145]  4023.4167  4062.1667  4153.3333  3959.5833  3683.6667  3523.8333
## [151]  3275.3333  5429.0833 10072.1667 12490.9167 13117.7500 13089.3333
## [157] 12703.6667 13389.3333 14209.9167 13949.9167 13128.5000 10835.5833
## [163]  6338.5833  4914.1667  4824.7500  4677.9167  4681.9167  4571.4167</code></pre>
</section><section id="j-what-to-do-column-operations-3" class="slide level2">
<h2><code>j</code>: “what to do” (column operations)</h2>
<ul>
<li>perform any operation in <code>j</code></li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">generation_dt[,<span class="dv">3</span><span class="op">*</span>wind <span class="op">+</span><span class="st"> </span>solar<span class="op">*</span>biogas<span class="op">/</span><span class="dv">2</span>]</a></code></pre></div>
<pre><code>##   [1]    8010.500    8336.500    8385.750    7747.750    7192.250    6981.000
##   [7]   15281.104  299488.556  834963.403 1067313.865 1152190.219 1224516.809
##  [13] 1208937.063 1167009.750 1144680.503 1057525.139  940937.062  720226.851
##  [19]  253363.437   36299.972   20083.757    9292.250    9178.000    8680.500
##  [25]    7570.750    7247.750    6618.250    4949.000    2974.500    2144.750
##  [31]   11623.257  301048.875  818965.771 1070041.833 1162682.375 1186467.375
##  [37] 1158653.917 1130800.819 1101875.361 1012419.097  774473.892  459216.771
##  [43]  130539.844    8291.333    5498.250    6188.750    5988.250    5206.250
##  [49]    4867.500    5170.500    5547.250    4656.500    4275.500    4090.000
##  [55]    7679.552  174050.236  542303.764  778465.625  896767.083 1025437.618
##  [61] 1039308.708  962964.028 1006242.375 1047985.944  923123.903  622641.361
##  [67]  205340.479    9971.083    6568.000    6236.750    6081.750    5786.000
##  [73]    6681.250    6277.750    5513.000    5659.750    5467.250    4991.000
##  [79]   12171.083  288830.812  821286.694 1074298.962 1169842.569 1208043.875
##  [85] 1196018.538 1192192.736 1167777.531 1148957.292 1033514.406  730203.069
##  [91]  240335.312   15614.528   12163.750   12148.250   12462.500   12323.250
##  [97]   12236.500   11577.750   11636.250   11429.750   11438.000   11017.500
## [103]   19031.681  329184.885  898422.906 1160500.597 1243934.573 1269358.573
## [109] 1263524.375 1258327.448 1259339.399 1225493.201 1124938.833  806581.688
## [115]  243456.469   14963.181   12137.500   13228.750   13226.000   12882.250
## [121]   10884.250    9354.250    8784.250    8179.750    8033.750    8316.500
## [127]   19276.000  342521.979  870872.969 1129279.528 1252038.667 1270701.833
## [133] 1281800.875 1295271.087 1289723.847 1240913.569 1120508.222  821549.778
## [139]  245504.903   17422.920   13094.000   12021.250   12596.750   12527.000
## [145]   12070.250   12186.500   12460.000   11878.750   11051.000   10571.500
## [151]   16690.240  283965.097  782179.382 1032321.813 1145888.167 1178856.688
## [157] 1215534.632 1236410.889 1240892.035 1176093.250 1070511.701  762856.212
## [163]  212023.250   16934.750   14474.250   14033.750   14045.750   13714.250</code></pre>
</section><section id="j-what-to-do-column-operations-4" class="slide level2">
<h2><code>j</code>: “what to do” (column operations)</h2>
<ul>
<li>perform any operation in <code>j</code></li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">generation_dt[,<span class="kw">mean</span>(nuclear)]</a></code></pre></div>
<pre><code>## [1] 2253.677</code></pre>
</section><section id="j-what-to-do-column-operations-5" class="slide level2">
<h2><code>j</code>: “what to do” (column operations)</h2>
<ul>
<li>a bit of syntax in <code>j</code> can either create a new column (<code>:=</code>) or return a new <code>data.table</code> ( .() )</li>
</ul>
</section><section id="j-what-to-do-column-operations-6" class="slide level2">
<h2><code>j</code>: “what to do” (column operations)</h2>
<ul>
<li>adding or modifying columns within the <code>data.table</code> uses <code>:=</code> (in place!)</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">generation_dt[,morewind <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">5</span><span class="op">*</span>wind]</a>
<a class="sourceLine" id="cb22-2" title="2">generation_dt[,all_RE <span class="op">:</span><span class="er">=</span><span class="st"> </span>wind<span class="op">+</span>solar<span class="op">+</span>geothermal]</a>
<a class="sourceLine" id="cb22-3" title="3">generation_dt[,morewind <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">5</span><span class="op">*</span>morewind <span class="op">+</span><span class="st"> </span><span class="dv">10</span>]</a></code></pre></div>
<ul>
<li>returning a new <code>data.table</code> uses <code>.()</code> (list alias). What do these return?</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">generation_dt[,.(wind)]</a>
<a class="sourceLine" id="cb23-2" title="2">generation_dt[,.(<span class="dt">RE_combo =</span> <span class="dv">3</span><span class="op">*</span>wind <span class="op">+</span><span class="st"> </span>solar<span class="op">*</span>biogas<span class="op">/</span><span class="dv">2</span>)]</a>
<a class="sourceLine" id="cb23-3" title="3">generation_dt[,.(<span class="dt">RE_combo =</span> <span class="dv">3</span><span class="op">*</span>wind <span class="op">+</span><span class="st"> </span>solar<span class="op">*</span>biogas<span class="op">/</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb23-4" title="4">                 <span class="dt">high_wind =</span> morewind)]</a></code></pre></div>
</section><section id="j-what-to-do-column-operations-7" class="slide level2">
<h2><code>j</code>: “what to do” (column operations)</h2>
<ul>
<li>columns may be deleted in <code>j</code></li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">generation_dt[,morewind <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</a>
<a class="sourceLine" id="cb24-2" title="2">generation_dt[,all_RE <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</a></code></pre></div>
</section><section id="j-what-to-do-column-operations-8" class="slide level2">
<h2><code>j</code>: “what to do” (column operations)</h2>
<ul>
<li><strong>try it!</strong> add a column to generation_dt called “total_hydro” that is the sum of the <code>small_hydro</code> and <code>large_hydro</code></li>
<li><strong>try it!</strong> return a new <code>data.table</code> with two columns: the mean of the <code>nuclear</code> column and the mean of the <code>biogas</code> column. What happens when you don’t name those columns?</li>
</ul>
</section><section id="j-what-to-do-column-operations-9" class="slide level2">
<h2><code>j</code>: “what to do” (column operations)</h2>
<ul>
<li><strong>try it!</strong> add a column to generation_dt called “total_hydro” that is the sum of the <code>small_hydro</code> and <code>large_hydro</code></li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">generation_dt[,total_hydro <span class="op">:</span><span class="er">=</span><span class="st"> </span>small_hydro <span class="op">+</span><span class="st"> </span>large_hydro]</a></code></pre></div>
<ul>
<li><strong>try it!</strong> return a new <code>data.table</code> with two columns: the mean of <code>nuclear</code> and the mean of <code>biogas</code>. What happens when you don’t name those columns?</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">generation_dt[,.(<span class="dt">mean_nuc =</span> <span class="kw">mean</span>(nuclear), <span class="dt">mean_biogas =</span> <span class="kw">mean</span>(biogas))]</a></code></pre></div>
<pre><code>##    mean_nuc mean_biogas
## 1: 2253.677    234.6855</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">generation_dt[,.(<span class="kw">mean</span>(nuclear), <span class="kw">mean</span>(biogas))]</a></code></pre></div>
<pre><code>##          V1       V2
## 1: 2253.677 234.6855</code></pre>
</section><section id="combine-i-and-j-operations" class="slide level2">
<h2>combine <code>i</code> and <code>j</code> operations</h2>
<ul>
<li><p><strong>try it!</strong> for the hours (rows) when wind generation is greater then 4,500 MW, add 500 to the values of small_hydro</p></li>
<li><p><strong>try it!</strong> when solar generation is zero, reurn a <code>data.table</code> with two columns: <code>datetime</code> and <code>total_thermal</code> (sum of natural gas and coal generation)</p></li>
<li><p><strong>bonus</strong> Use <code>:=</code> to create a new column called more_solar (which is 9 times the values in the solar column) but only for hours where solar &gt; 0. What happens in the other rows?</p></li>
</ul>
</section><section id="combine-i-and-j-operations-1" class="slide level2">
<h2>combine <code>i</code> and <code>j</code> operations</h2>
<ul>
<li><strong>try it!</strong> for the hours (rows) when wind generation is greater then 4,500 MW, add 500 to the values of small_hydro</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1">generation_dt[wind <span class="op">&gt;</span><span class="st"> </span><span class="dv">4500</span>, small_hydro <span class="op">:</span><span class="er">=</span><span class="st"> </span>small_hydro <span class="op">+</span><span class="st"> </span><span class="dv">500</span>]</a></code></pre></div>
<ul>
<li><strong>try it!</strong> when solar generation is zero, reurn a <code>data.table</code> with two columns: <code>datetime</code> and <code>total_thermal</code> (sum of natural gas and coal generation)</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">generation_dt[solar <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, .(datetime, <span class="dt">total_thermal =</span> natural_gas <span class="op">+</span><span class="st"> </span>coal)]</a></code></pre></div>
<ul>
<li><strong>bonus</strong> Use <code>:=</code> to create a new column called more_solar (which is 9 times the values in the solar column) but only for hours where solar &gt; 0. What happens in the other rows?</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">generation_dt[solar <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, more_solar <span class="op">:</span><span class="er">=</span><span class="st"> </span>solar<span class="op">*</span><span class="dv">9</span>]</a></code></pre></div>
<p>This will fill in the rest of the rows (where solar &gt; 0 is not true) with NA.</p>
</section></section>
<section><section id="by-grouped-by-what" class="title-slide slide level1"><h1><code>by</code>: “grouped by what”</h1></section><section id="by-grouped-by-what-1" class="slide level2">
<h2><code>by</code>: “grouped by what”</h2>
<ul>
<li>add grouping to any operation</li>
<li>what does this do?</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1">generation_dt[,<span class="kw">mean</span>(nuclear), by =<span class="st"> </span><span class="kw">mday</span>(datetime)]</a></code></pre></div>
<pre><code>##    mday       V1
## 1:    3 2246.920
## 2:    4 2246.087
## 3:    5 2253.396
## 4:    6 2252.580
## 5:    7 2254.882
## 6:    8 2257.490
## 7:    9 2264.385</code></pre>
<ul>
<li class="fragment">how could you add more useful names to these columns?</li>
</ul>
</section><section id="by-grouped-by-what-2" class="slide level2">
<h2><code>by</code>: “grouped by what”</h2>
<ul>
<li>adding more useful column names:</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1">generation_dt[,.(<span class="dt">mean_nuc =</span> <span class="kw">mean</span>(nuclear)), by =<span class="st"> </span>.(<span class="dt">day =</span> <span class="kw">mday</span>(datetime))]</a></code></pre></div>
<pre><code>##    day mean_nuc
## 1:   3 2246.920
## 2:   4 2246.087
## 3:   5 2253.396
## 4:   6 2252.580
## 5:   7 2254.882
## 6:   8 2257.490
## 7:   9 2264.385</code></pre>
</section><section id="by-grouped-by-what-3" class="slide level2">
<h2><code>by</code>: “grouped by what”</h2>
<ul>
<li>this is where we can see the (now familiar) power of long form data:</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="co"># melt generation_dt</span></a>
<a class="sourceLine" id="cb37-2" title="2">generation_dt_long &lt;-<span class="st"> </span><span class="kw">melt</span>(generation_dt, </a>
<a class="sourceLine" id="cb37-3" title="3">                           <span class="dt">id.vars =</span> <span class="st">&quot;datetime&quot;</span>, </a>
<a class="sourceLine" id="cb37-4" title="4">                           <span class="dt">variable.name =</span> <span class="st">&quot;gen_type&quot;</span>, </a>
<a class="sourceLine" id="cb37-5" title="5">                           <span class="dt">value.name =</span> <span class="st">&quot;MW&quot;</span>)</a></code></pre></div>
<ul>
<li>what is that warning message about? (hint: check str(generation_dt)). How could this be avoided in the future?</li>
</ul>
</section><section id="by-grouped-by-what-4" class="slide level2">
<h2><code>by</code>: “grouped by what”</h2>
<ul>
<li>now find the mean of MW by gen_type…</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1">generation_dt_long[,.(<span class="dt">mean_MW =</span> <span class="kw">mean</span>(MW)), by =<span class="st"> </span>gen_type]</a></code></pre></div>
<pre><code>##        gen_type      mean_MW
##  1:      biogas   234.685516
##  2:     biomass   374.343254
##  3:        coal     9.092758
##  4:  geothermal   964.964782
##  5: large_hydro  2968.263889
##  6: natural_gas 10634.254960
##  7:     nuclear  2253.677083
##  8:       other     0.000000
##  9: small_hydro   419.438492
## 10:       solar  3930.446429
## 11:        wind  2619.791171
## 12: total_hydro  3387.702381</code></pre>
<ul>
<li>or by day and by gen_type…</li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1">generation_dt_long[,.(<span class="dt">mean_MW =</span> <span class="kw">mean</span>(MW)), </a>
<a class="sourceLine" id="cb40-2" title="2">                   by =<span class="st"> </span>.(<span class="dt">day =</span> <span class="kw">mday</span>(datetime), gen_type)]</a></code></pre></div>
<pre><code>##     day    gen_type      mean_MW
##  1:   3      biogas   235.746528
##  2:   4      biogas   233.055556
##  3:   5      biogas   235.270833
##  4:   6      biogas   236.118056
##  5:   7      biogas   238.090278
##  6:   8      biogas   236.017361
##  7:   9      biogas   228.500000
##  8:   3     biomass   409.645833
##  9:   4     biomass   385.854167
## 10:   5     biomass   352.163194
## 11:   6     biomass   358.510417
## 12:   7     biomass   380.704861
## 13:   8     biomass   362.388889
## 14:   9     biomass   371.135417
## 15:   3        coal     8.986111
## 16:   4        coal     9.128472
## 17:   5        coal     9.500000
## 18:   6        coal     8.892361
## 19:   7        coal     6.569444
## 20:   8        coal     7.236111
## 21:   9        coal    13.336806
## 22:   3  geothermal   960.274306
## 23:   4  geothermal   960.201389
## 24:   5  geothermal   964.569444
## 25:   6  geothermal   964.326389
## 26:   7  geothermal   963.840278
## 27:   8  geothermal   967.381944
## 28:   9  geothermal   974.159722
## 29:   3 large_hydro  3477.944444
## 30:   4 large_hydro  3580.166667
## 31:   5 large_hydro  3432.618056
## 32:   6 large_hydro  3352.111111
## 33:   7 large_hydro  2421.420139
## 34:   8 large_hydro  2096.031250
## 35:   9 large_hydro  2417.555556
## 36:   3 natural_gas 13050.864583
## 37:   4 natural_gas 14927.760417
## 38:   5 natural_gas 15403.371528
## 39:   6 natural_gas 12786.263889
## 40:   7 natural_gas  7508.375000
## 41:   8 natural_gas  4518.003472
## 42:   9 natural_gas  6245.145833
## 43:   3     nuclear  2246.920139
## 44:   4     nuclear  2246.086806
## 45:   5     nuclear  2253.395833
## 46:   6     nuclear  2252.579861
## 47:   7     nuclear  2254.881944
## 48:   8     nuclear  2257.489583
## 49:   9     nuclear  2264.385417
## 50:   3       other     0.000000
## 51:   4       other     0.000000
## 52:   5       other     0.000000
## 53:   6       other     0.000000
## 54:   7       other     0.000000
## 55:   8       other     0.000000
## 56:   9       other     0.000000
## 57:   3 small_hydro   435.368056
## 58:   4 small_hydro   430.854167
## 59:   5 small_hydro   423.746528
## 60:   6 small_hydro   429.125000
## 61:   7 small_hydro   396.677083
## 62:   8 small_hydro   406.833333
## 63:   9 small_hydro   413.465278
## 64:   3       solar  3936.635417
## 65:   4       solar  3722.336806
## 66:   5       solar  3265.138889
## 67:   6       solar  3990.791667
## 68:   7       solar  4191.677083
## 69:   8       solar  4245.746528
## 70:   9       solar  4160.798611
## 71:   3        wind  2095.381944
## 72:   4        wind  1190.125000
## 73:   5        wind  1504.118056
## 74:   6        wind  2225.656250
## 75:   7        wind  3907.954861
## 76:   8        wind  3696.673611
## 77:   9        wind  3718.628472
## 78:   3 total_hydro  3913.312500
## 79:   4 total_hydro  4011.020833
## 80:   5 total_hydro  3856.364583
## 81:   6 total_hydro  3781.236111
## 82:   7 total_hydro  2818.097222
## 83:   8 total_hydro  2502.864583
## 84:   9 total_hydro  2831.020833
##     day    gen_type      mean_MW</code></pre>
<ul>
<li>note that by accepts: a single column name, a list, or a character vector</li>
</ul>
</section><section id="by-grouped-by-what-5" class="slide level2">
<h2><code>by</code>: “grouped by what”</h2>
<ul>
<li><code>by</code> combines easily with everything we’ve learned about <code>i</code> and <code>j</code></li>
<li>example: find the mean and sum of generation for each day, for all resources EXCEPT natural gas</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1">generation_dt_long[gen_type <span class="op">!=</span><span class="st"> &quot;natural_gas&quot;</span>,</a>
<a class="sourceLine" id="cb42-2" title="2">                   .(<span class="dt">mean_MW =</span> <span class="kw">mean</span>(MW), <span class="dt">sum_MW =</span> <span class="kw">sum</span>(MW)), </a>
<a class="sourceLine" id="cb42-3" title="3">                   by =<span class="st"> </span><span class="kw">mday</span>(datetime)]</a></code></pre></div>
<pre><code>##    mday  mean_MW   sum_MW
## 1:    3 1610.929 425285.2
## 2:    4 1524.439 402451.9
## 3:    5 1481.535 391125.3
## 4:    6 1599.941 422384.3
## 5:    7 1598.174 421917.9
## 6:    8 1525.333 402687.9
## 7:    9 1581.181 417431.7</code></pre>
</section><section id="by-grouped-by-what-6" class="slide level2">
<h2><code>by</code>: “grouped by what”</h2>
<ul>
<li><strong>try it!</strong> find the median solar generation by hour.</li>
<li><strong>try it!</strong> for hours when the solar generation is greater than zero, find the maximum natural gas generation by day</li>
</ul>
</section><section id="by-grouped-by-what-7" class="slide level2">
<h2><code>by</code>: “grouped by what”</h2>
<ul>
<li><strong>try it!</strong> find the median solar generation by day</li>
</ul>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1">generation_dt[,<span class="kw">median</span>(solar), by =<span class="st"> </span><span class="kw">mday</span>(datetime)]</a>
<a class="sourceLine" id="cb44-2" title="2"></a>
<a class="sourceLine" id="cb44-3" title="3">generation_dt_long[gen_type <span class="op">==</span><span class="st"> &quot;solar&quot;</span>, <span class="kw">median</span>(MW), by =<span class="st"> </span><span class="kw">mday</span>(datetime)]</a></code></pre></div>
<ul>
<li><strong>try it!</strong> for hours when the solar generation is greater than zero, find the maximum natural gas generation by day</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1">generation_dt[solar <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="kw">max</span>(natural_gas), by =<span class="st"> </span><span class="kw">mday</span>(datetime)]</a></code></pre></div>
</section><section id="data.table-syntax-recap" class="slide level2">
<h2><code>data.table</code> syntax recap</h2>
<p><img data-src="figures/dt_structure.PNG" /></p>
<ul>
<li class="fragment">the combination of <code>i</code>, <code>j</code>, and <code>by</code> is very powerful</li>
<li class="fragment">column names are variables inside <code>dt[]</code></li>
<li class="fragment">few other components; outside scope of this review</li>
</ul>
</section></section>
<section><section id="data.table-upgrades-to-other-functions" class="title-slide slide level1"><h1><code>data.table</code> upgrades to other functions</h1></section><section id="data.table-upgrades-to-other-functions-1" class="slide level2">
<h2><code>data.table</code> upgrades to other functions</h2>
<p><code>data.table</code> contains its own versions some functions we’ve already talked about, for example. These generally are optimized for <code>data.table</code>s and have extra (advanced) features.</p>
<ul>
<li class="fragment"><code>melt</code></li>
<li class="fragment"><code>dcast</code></li>
<li class="fragment"><code>merge</code></li>
<li class="fragment"><code>order</code></li>
</ul>
</section><section id="dplyr---data.table" class="slide level2">
<h2><code>dplyr</code> -&gt; <code>data.table</code></h2>
<p>We can now practice toggling between <code>dplyr</code> and <code>data.table</code> syntax.</p>
<p><strong>try it!</strong> Convert this <code>dplyr</code> syntax into <code>data.table</code> syntax (remember that this melted the generation table, then found the mean of large_hydro and biomass generation)</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1">generation_dt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-2" title="2"><span class="st">  </span><span class="kw">select</span>(datetime, large_hydro, biomass) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-3" title="3"><span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.vars =</span> <span class="st">&quot;datetime&quot;</span>,</a>
<a class="sourceLine" id="cb46-4" title="4">       <span class="dt">variable.name =</span> <span class="st">&quot;source&quot;</span>,</a>
<a class="sourceLine" id="cb46-5" title="5">       <span class="dt">value.name =</span> <span class="st">&quot;usage&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-6" title="6"><span class="st">  </span><span class="kw">group_by</span>(source) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-7" title="7"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_usage =</span> <span class="kw">mean</span>(usage, <span class="dt">na.rm =</span> T))</a></code></pre></div>
</section><section id="dplyr---data.table-1" class="slide level2">
<h2><code>dplyr</code> -&gt; <code>data.table</code></h2>
<p><strong>try it!</strong> Convert this <code>dplyr</code> syntax into <code>data.table</code> syntax (remember that this melted the generation table, then found the mean of large_hydro and biomass generation)</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">generation_dt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb47-2" title="2"><span class="st">  </span><span class="kw">select</span>(datetime, large_hydro, biomass) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb47-3" title="3"><span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.vars =</span> <span class="st">&quot;datetime&quot;</span>,</a>
<a class="sourceLine" id="cb47-4" title="4">       <span class="dt">variable.name =</span> <span class="st">&quot;source&quot;</span>,</a>
<a class="sourceLine" id="cb47-5" title="5">       <span class="dt">value.name =</span> <span class="st">&quot;usage&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb47-6" title="6"><span class="st">  </span><span class="kw">group_by</span>(source) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb47-7" title="7"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_usage =</span> <span class="kw">mean</span>(usage, <span class="dt">na.rm =</span> T))</a>
<a class="sourceLine" id="cb47-8" title="8"></a>
<a class="sourceLine" id="cb47-9" title="9"><span class="co"># becomes</span></a>
<a class="sourceLine" id="cb47-10" title="10">generation_dt_long &lt;-<span class="st"> </span><span class="kw">melt</span>(generation_dt, </a>
<a class="sourceLine" id="cb47-11" title="11">                           <span class="dt">id.vars =</span> <span class="st">&quot;datetime&quot;</span>, </a>
<a class="sourceLine" id="cb47-12" title="12">                           <span class="dt">variable.name =</span> <span class="st">&quot;gen_type&quot;</span>, </a>
<a class="sourceLine" id="cb47-13" title="13">                           <span class="dt">value.name =</span> <span class="st">&quot;MW&quot;</span>)</a>
<a class="sourceLine" id="cb47-14" title="14"></a>
<a class="sourceLine" id="cb47-15" title="15">generation_dt_long[gen_type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;large_hydro&quot;</span>, <span class="st">&quot;biomass&quot;</span>),</a>
<a class="sourceLine" id="cb47-16" title="16">                   .(<span class="dt">mean_usage =</span> <span class="kw">mean</span>(MW)),</a>
<a class="sourceLine" id="cb47-17" title="17">                   by =<span class="st"> </span>gen_type]</a></code></pre></div>
</section></section>
<section><section id="a-few-more-data.table-properties-and-bonus-features" class="title-slide slide level1"><h1>A few more <code>data.table</code> properties and bonus features</h1></section><section id="set-functions" class="slide level2">
<h2><code>set</code> functions</h2>
<ul>
<li>Remember <code>:=</code> ? It is part of <code>data.table</code>’s <code>set</code> functions, which all update properties of the <code>data.table</code> by reference</li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1"><span class="co"># set colum</span></a>
<a class="sourceLine" id="cb48-2" title="2">dt[,col1 <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>col2]</a>
<a class="sourceLine" id="cb48-3" title="3"></a>
<a class="sourceLine" id="cb48-4" title="4"><span class="co"># set column names</span></a>
<a class="sourceLine" id="cb48-5" title="5"><span class="kw">setnames</span>(dt, <span class="st">&quot;old&quot;</span>, <span class="st">&quot;new&quot;</span>)</a>
<a class="sourceLine" id="cb48-6" title="6"></a>
<a class="sourceLine" id="cb48-7" title="7"><span class="co"># set row order</span></a>
<a class="sourceLine" id="cb48-8" title="8"><span class="kw">setorder</span>(dt, col1, <span class="op">-</span>col2, ...)</a>
<a class="sourceLine" id="cb48-9" title="9"></a>
<a class="sourceLine" id="cb48-10" title="10"><span class="co"># set anything</span></a>
<a class="sourceLine" id="cb48-11" title="11"><span class="kw">set</span>(dt, i, j, value)</a></code></pre></div>
<ul>
<li>we won’t do exercises with these, but these are important to know about</li>
</ul>
</section><section id="fread-and-fwrite" class="slide level2">
<h2><code>fread</code> and <code>fwrite</code></h2>
<ul>
<li class="fragment">“Fast and friendly file finagler” - <em>help file</em></li>
<li class="fragment">“Similar to read.table but faster and more convenient” - <em>help file</em></li>
<li class="fragment"><code>stringsAsFactors=FALSE</code> already set</li>
</ul>
</section><section id="fread-benchmarks" class="slide level2">
<h2>fread benchmarks</h2>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1"><span class="co"># example, no need to run this</span></a>
<a class="sourceLine" id="cb49-2" title="2"><span class="kw">library</span>(rbenchmark)</a>
<a class="sourceLine" id="cb49-3" title="3"></a>
<a class="sourceLine" id="cb49-4" title="4"><span class="co"># this will run each command 500 times and report the average time taken</span></a>
<a class="sourceLine" id="cb49-5" title="5"></a>
<a class="sourceLine" id="cb49-6" title="6"><span class="co"># 168 lines</span></a>
<a class="sourceLine" id="cb49-7" title="7">data_file &lt;-<span class="st"> &quot;generation.csv&quot;</span></a>
<a class="sourceLine" id="cb49-8" title="8"><span class="kw">benchmark</span>(<span class="kw">read.csv</span>(data_file, <span class="dt">stringsAsFactors =</span> F), </a>
<a class="sourceLine" id="cb49-9" title="9">          <span class="kw">fread</span>(data_file), </a>
<a class="sourceLine" id="cb49-10" title="10">          <span class="dt">replications =</span> <span class="dv">500</span>)</a>
<a class="sourceLine" id="cb49-11" title="11"></a>
<a class="sourceLine" id="cb49-12" title="12"><span class="co">#                                        test replications elapsed relative user.self sys.self user.child sys.child</span></a>
<a class="sourceLine" id="cb49-13" title="13"><span class="co"># 2                          fread(data_file)          500    0.62    1.000      0.50     0.12         NA        NA</span></a>
<a class="sourceLine" id="cb49-14" title="14"><span class="co"># 1 read.csv(data_file, stringsAsFactors = F)          500    0.67    1.081      0.54     0.13         NA        NA</span></a>
<a class="sourceLine" id="cb49-15" title="15"></a>
<a class="sourceLine" id="cb49-16" title="16"><span class="co"># 12,600 lines</span></a>
<a class="sourceLine" id="cb49-17" title="17">data_file_medium &lt;-<span class="st"> &quot;generation_medium.csv&quot;</span></a>
<a class="sourceLine" id="cb49-18" title="18"><span class="kw">benchmark</span>(<span class="kw">read.csv</span>(data_file_medium, <span class="dt">stringsAsFactors =</span> F), </a>
<a class="sourceLine" id="cb49-19" title="19">          <span class="kw">fread</span>(data_file_medium))</a>
<a class="sourceLine" id="cb49-20" title="20"></a>
<a class="sourceLine" id="cb49-21" title="21"><span class="co">#                                               test replications elapsed relative user.self sys.self user.child sys.child</span></a>
<a class="sourceLine" id="cb49-22" title="22"><span class="co"># 2                          fread(data_file_medium)          100    0.77    1.000      0.72     0.05         NA        NA</span></a>
<a class="sourceLine" id="cb49-23" title="23"><span class="co"># 1 read.csv(data_file_medium, stringsAsFactors = F)          100    4.28    5.558      4.22     0.06         NA        NA</span></a>
<a class="sourceLine" id="cb49-24" title="24"></a>
<a class="sourceLine" id="cb49-25" title="25"><span class="co"># 1,008,000 lines</span></a>
<a class="sourceLine" id="cb49-26" title="26">data_file_large &lt;-<span class="st"> &quot;generation_large.csv&quot;</span></a>
<a class="sourceLine" id="cb49-27" title="27"><span class="kw">benchmark</span>(<span class="kw">read.csv</span>(data_file_large, <span class="dt">stringsAsFactors =</span> F), </a>
<a class="sourceLine" id="cb49-28" title="28">          <span class="kw">fread</span>(data_file_large),</a>
<a class="sourceLine" id="cb49-29" title="29">          <span class="dt">replications =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb49-30" title="30"></a>
<a class="sourceLine" id="cb49-31" title="31"><span class="co">#                                              test replications elapsed relative user.self sys.self user.child sys.child</span></a>
<a class="sourceLine" id="cb49-32" title="32"><span class="co"># 2                          fread(data_file_large)           20    2.67    1.000      7.07     1.10         NA        NA</span></a>
<a class="sourceLine" id="cb49-33" title="33"><span class="co"># 1 read.csv(data_file_large, stringsAsFactors = F)           20   74.59   27.936     71.53     3.05         NA        NA</span></a></code></pre></div>
</section><section id="special-variables" class="slide level2">
<h2>Special variables</h2>
<p><code>data.table</code>s also contain some special read-only symbols that are often useful:</p>
<ul>
<li><code>.N</code>: number of rows in the current group</li>
<li><code>.I</code>: a vector, <code>1:nrow(dt)</code>, usually used for more advanced operations</li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1"><span class="co"># for .N: convenient</span></a>
<a class="sourceLine" id="cb50-2" title="2">generation_dt[,.N] </a>
<a class="sourceLine" id="cb50-3" title="3"></a>
<a class="sourceLine" id="cb50-4" title="4"><span class="co"># for .I: more advanced syntax</span></a>
<a class="sourceLine" id="cb50-5" title="5">generation_dt[,.I]</a></code></pre></div>
</section><section id="special-variables-1" class="slide level2">
<h2>Special variables</h2>
<p><strong>try it!</strong> Use <code>.N</code> to find the number of rows in generation_dt_long</p>
<p><strong>try it!</strong> Use <code>.N</code> to find the number of hours in which solar generation was greater than 500 MW</p>
</section><section id="special-variables-2" class="slide level2">
<h2>Special variables</h2>
<p><strong>try it!</strong> Use <code>.N</code> to find the number of rows in generation_dt_long</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">generation_dt_long[,.N]</a></code></pre></div>
<p><strong>try it!</strong> Use <code>.N</code> to find the number of hours in which solar generation was greater than 500 MW</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1">generation_dt[solar <span class="op">&gt;</span><span class="st"> </span><span class="dv">500</span>, .N]</a>
<a class="sourceLine" id="cb52-2" title="2">generation_dt_long[gen_type <span class="op">==</span><span class="st"> &quot;solar&quot;</span> <span class="op">&amp;</span><span class="st"> </span>MW <span class="op">&gt;</span><span class="st"> </span><span class="dv">500</span>,.N]</a></code></pre></div>
</section><section id="other-features-keys" class="slide level2">
<h2>Other features: keys</h2>
<ul>
<li>keys: one or more columns, pre-sorted index of the table. Setting a key makes joining and other operations much faster, because rows are already sorted (note: set function)</li>
<li>I rarely use it unless I’m working with lots of data, mostly because I prefer to explicitly name columns for clarity (when possible)</li>
</ul>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="co"># check the current key</span></a>
<a class="sourceLine" id="cb53-2" title="2"><span class="kw">key</span>(generation_dt)</a>
<a class="sourceLine" id="cb53-3" title="3"></a>
<a class="sourceLine" id="cb53-4" title="4"><span class="co"># set key</span></a>
<a class="sourceLine" id="cb53-5" title="5"><span class="kw">setkey</span>(generation_dt, datetime)</a>
<a class="sourceLine" id="cb53-6" title="6"><span class="kw">key</span>(generation_dt)</a></code></pre></div>
</section><section id="other-features-joins" class="slide level2">
<h2>Other features: joins</h2>
<ul>
<li>joins: <code>data.table</code> has a special join syntax</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1">imports_dt &lt;-<span class="st"> </span><span class="kw">fread</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;ca_energy_imports.csv&quot;</span>))</a>
<a class="sourceLine" id="cb54-2" title="2"></a>
<a class="sourceLine" id="cb54-3" title="3">imports_dt</a></code></pre></div>
<pre><code>##                 datetime   imports
##   1: 2019-09-03 00:00:00  7527.333
##   2: 2019-09-03 01:00:00  6930.333
##   3: 2019-09-03 02:00:00  7005.833
##   4: 2019-09-03 03:00:00  7080.583
##   5: 2019-09-03 04:00:00  7421.667
##  ---                              
## 164: 2019-09-09 19:00:00 10002.667
## 165: 2019-09-09 20:00:00  9994.083
## 166: 2019-09-09 21:00:00  9690.167
## 167: 2019-09-09 22:00:00  7998.000
## 168: 2019-09-09 23:00:00  7570.750</code></pre>
</section><section id="other-features-joins-1" class="slide level2">
<h2>Other features: joins</h2>
<ul>
<li>joins: <code>data.table</code> has a special join syntax. this returns a new <code>data.table</code>. It does not modify imports_dt in place</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1"><span class="co"># set key or specify on </span></a>
<a class="sourceLine" id="cb56-2" title="2">imports_dt[generation_dt, on =<span class="st"> &quot;datetime&quot;</span>]</a></code></pre></div>
<pre><code>##                 datetime   imports   biogas  biomass      coal geothermal
##   1: 2019-09-03 00:00:00  7527.333 238.9167 407.0833  9.000000   967.2500
##   2: 2019-09-03 01:00:00  6930.333 239.0000 406.5000  9.000000   970.3333
##   3: 2019-09-03 02:00:00  7005.833 239.0000 406.8333  9.000000   973.1667
##   4: 2019-09-03 03:00:00  7080.583 238.9167 407.1667  9.833333   973.8333
##   5: 2019-09-03 04:00:00  7421.667 237.9167 406.0833  9.416667   974.6667
##  ---                                                                     
## 164: 2019-09-09 19:00:00 10002.667 228.0000 388.4167 12.000000   978.5000
## 165: 2019-09-09 20:00:00  9994.083 227.8333 386.4167 12.583333   979.7500
## 166: 2019-09-09 21:00:00  9690.167 231.1667 383.1667 12.333333   980.5833
## 167: 2019-09-09 22:00:00  7998.000 231.1667 368.9167 13.083333   980.5833
## 168: 2019-09-09 23:00:00  7570.750 231.5000 358.9167 13.750000   980.3333
##      large_hydro natural_gas  nuclear other small_hydro solar     wind
##   1:    3152.500    9710.833 2248.750     0    401.6667  0.00 2670.167
##   2:    2724.333    9155.000 2250.583     0    400.9167  0.00 2778.833
##   3:    2630.000    8078.333 2250.833     0    413.5833  0.00 2795.250
##   4:    2611.250    7801.250 2245.000     0    359.9167  0.00 2582.583
##   5:    2651.333    7744.333 2242.833     0    382.0833  0.00 2397.417
##  ---                                                                  
## 164:    4413.583    9761.583 2269.000     0    480.6667 19.75 4894.417
## 165:    4414.667    9210.583 2267.583     0    467.1667  0.00 4824.750
## 166:    3771.417    8475.083 2265.417     0    471.7500  0.00 4677.917
## 167:    3305.167    8056.750 2265.417     0    435.6667  0.00 4681.917
## 168:    2704.583    6895.417 2266.000     0    413.1667  0.00 4571.417
##      total_hydro
##   1:    3554.167
##   2:    3125.250
##   3:    3043.583
##   4:    2971.167
##   5:    3033.417
##  ---            
## 164:    4894.250
## 165:    4881.833
## 166:    4243.167
## 167:    3740.833
## 168:    3117.750</code></pre>
</section><section id="other-features-joins-2" class="slide level2">
<h2>Other features: joins</h2>
<ul>
<li>joins: <code>data.table</code> has a special join syntax. this does modify imports_dt in place (the presence of <code>:=</code> is a hint)</li>
</ul>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1"><span class="co"># operations can be performed in the same step as the merge</span></a>
<a class="sourceLine" id="cb58-2" title="2">imports_dt[generation_dt, on =<span class="st"> &quot;datetime&quot;</span>, imports_gas <span class="op">:</span><span class="er">=</span><span class="st"> </span>imports <span class="op">+</span><span class="st"> </span>i.natural_gas]</a>
<a class="sourceLine" id="cb58-3" title="3"></a>
<a class="sourceLine" id="cb58-4" title="4">imports_dt</a></code></pre></div>
<pre><code>##                 datetime   imports imports_gas
##   1: 2019-09-03 00:00:00  7527.333    17238.17
##   2: 2019-09-03 01:00:00  6930.333    16085.33
##   3: 2019-09-03 02:00:00  7005.833    15084.17
##   4: 2019-09-03 03:00:00  7080.583    14881.83
##   5: 2019-09-03 04:00:00  7421.667    15166.00
##  ---                                          
## 164: 2019-09-09 19:00:00 10002.667    19764.25
## 165: 2019-09-09 20:00:00  9994.083    19204.67
## 166: 2019-09-09 21:00:00  9690.167    18165.25
## 167: 2019-09-09 22:00:00  7998.000    16054.75
## 168: 2019-09-09 23:00:00  7570.750    14466.17</code></pre>
</section><section id="other-features-joins-3" class="slide level2">
<h2>Other features: joins</h2>
<ul>
<li>joins: <code>data.table</code> has a special join syntax. This can become very complex if you want it to!</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1"><span class="co"># operations can be performed in the same step as the merge</span></a>
<a class="sourceLine" id="cb60-2" title="2">imports_dt[generation_dt[<span class="kw">hour</span>(datetime) <span class="op">==</span><span class="st"> </span><span class="dv">2</span>], on =<span class="st"> &quot;datetime&quot;</span>, imports_gas_<span class="dv">2</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span>imports <span class="op">+</span><span class="st"> </span>i.natural_gas]</a>
<a class="sourceLine" id="cb60-3" title="3"></a>
<a class="sourceLine" id="cb60-4" title="4">imports_dt</a></code></pre></div>
<pre><code>##                 datetime   imports imports_gas imports_gas_2
##   1: 2019-09-03 00:00:00  7527.333    17238.17            NA
##   2: 2019-09-03 01:00:00  6930.333    16085.33            NA
##   3: 2019-09-03 02:00:00  7005.833    15084.17      15084.17
##   4: 2019-09-03 03:00:00  7080.583    14881.83            NA
##   5: 2019-09-03 04:00:00  7421.667    15166.00            NA
##  ---                                                        
## 164: 2019-09-09 19:00:00 10002.667    19764.25            NA
## 165: 2019-09-09 20:00:00  9994.083    19204.67            NA
## 166: 2019-09-09 21:00:00  9690.167    18165.25            NA
## 167: 2019-09-09 22:00:00  7998.000    16054.75            NA
## 168: 2019-09-09 23:00:00  7570.750    14466.17            NA</code></pre>
</section></section>
<section><section id="final-thoughts" class="title-slide slide level1"><h1>Final thoughts</h1></section><section id="final-thoughts-1" class="slide level2">
<h2>Final thoughts</h2>
<ul>
<li>developers: Matt Dowle, Arun Srinivasan (look out for them on stack overflow)</li>
<li>useful <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">introduction</a> to <code>data.table</code></li>
<li>also useful <code>data.table</code> <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-faq.html">FAQ</a></li>
<li><a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-reshape.html">Intro to advanced features</a> of <code>data.table</code> <code>melt</code> and <code>dcast</code> functions</li>
<li>or any other vignette</li>
</ul>
</section></section>
    </div>
  </div>

  <script src="day6_datatable_slides_files/reveal.js-3.3.0.1/lib/js/head.min.js"></script>
  <script src="day6_datatable_slides_files/reveal.js-3.3.0.1/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: false,
        // Transition style
        transition: 'default', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom
        height: 800,



        // Optional reveal.js plugins
        dependencies: [
          { src: 'day6_datatable_slides_files/reveal.js-3.3.0.1/plugin/notes/notes.js', async: true },
        ]
      });
    </script>
  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

<script>
  (function() {
    if (window.jQuery) {
      Reveal.addEventListener( 'slidechanged', function(event) {  
        window.jQuery(event.previousSlide).trigger('hidden');
        window.jQuery(event.currentSlide).trigger('shown');
      });
    }
  })();
</script>


  </body>
</html>
